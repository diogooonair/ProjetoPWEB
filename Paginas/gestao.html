<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Drones</title>
    <link rel="stylesheet" href="ubi.css"> <!-- Inclua aqui seu arquivo CSS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
    <h2>Gestão de Drones</h2>
    <p>Gerencie as peças e as montagens dos seus drones</p>
</header>
<main>
    <section id="pecas">
        <h3>Gestão de Peças</h3>
        <form id="form-peca">
            <div class="container">
                <div class="input-item">
                    <label for="peca-nome">Nome da Peça:</label>
                    <input id="peca-nome" class="form-input" type="text" required>
                </div>
                <div class="input-item">
                    <label for="peca-quantidade">Quantidade:</label>
                    <input id="peca-quantidade" class="form-input" type="number" required>
                </div>
                <button type="submit">Adicionar Peça</button>
            </div>
        </form>
    </section>

    <section id="montagens">
        <h3>Gestão de Montagens</h3>
        <form id="form-montagem">
            <div class="container">
                <div class="input-item">
                    <label for="drone-modelo">Modelo do Drone:</label>
                    <input id="drone-modelo" class="form-input" type="text" required>
                </div>
                <div class="input-item">
                    <label for="pecas-necessarias">Peças Necessárias:</label>
                    <select id="pecas-necessarias" class="form-input" multiple required>
                        <!-- Opções de peças serão adicionadas dinamicamente via JavaScript -->
                    </select>
                </div>
                <button type="submit">Adicionar Montagem</button>
            </div>
        </form>
    </section>

    <section id="estatisticas">
        <h3>Estatísticas</h3>
        <div class="container">
            <canvas id="grafico-pecas" width="400" height="200"></canvas>
            <canvas id="grafico-montagens" width="400" height="200"></canvas>
        </div>
    </section>
</main>

<script>
    // Função para carregar opções de peças
    async function carregarPecas() {
        try {
            const response = await fetch('/pecas');
            const pecas = await response.json();

            const selectElement = document.getElementById('pecas-necessarias');
            selectElement.innerHTML = ''; // Limpar as opções atuais
            pecas.forEach(peca => {
                const option = document.createElement('option');
                option.value = peca._id; // Supondo que o ID da peça seja utilizado como valor
                option.text = peca.nome;
                selectElement.appendChild(option);
            });
        } catch (error) {
            console.error('Erro ao carregar opções de peças:', error);
        }
    }

    // Chamar a função para carregar as opções de peças quando a página carregar
    window.onload = carregarPecas;

    // Adicionar peça
    document.getElementById('form-peca').addEventListener('submit', async function(event) {
        event.preventDefault();

        const nome = document.getElementById('peca-nome').value;
        const quantidade = document.getElementById('peca-quantidade').value;

        try {
            const response = await fetch('/pecas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nome, quantidade })
            });

            if (response.ok) {
                alert('Peça adicionada com sucesso');
                document.getElementById('form-peca').reset();
                carregarPecas(); // Recarregar opções de peças
            } else {
                alert('Erro ao adicionar peça');
            }
        } catch (error) {
            console.error('Erro ao adicionar peça:', error);
        }
    });

    // Adicionar montagem
    document.getElementById('form-montagem').addEventListener('submit', async function(event) {
        event.preventDefault();

        const modeloDrone = document.getElementById('drone-modelo').value;
        const pecasNecessarias = Array.from(document.getElementById('pecas-necessarias').selectedOptions).map(option => option.value);

        try {
            const response = await fetch('/montagens', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ modeloDrone, pecasNecessarias })
            });

            if (response.ok) {
                alert('Montagem adicionada com sucesso');
                document.getElementById('form-montagem').reset();
            } else {
                alert('Erro ao adicionar montagem');
            }
        } catch (error) {
            console.error('Erro ao adicionar montagem:', error);
        }
    });

    // Função para criar gráficos
    function criarGraficos() {
        const ctxPecas = document.getElementById('grafico-pecas').getContext('2d');
        const ctxMontagens = document.getElementById('grafico-montagens').getContext('2d');

        // Gráfico de barras para quantidade de peças
        new Chart(ctxPecas, {
            type: 'bar',
            data: {
                labels: ['Peça A', 'Peça B', 'Peça C'], // Exemplos de nomes de peças
                datasets: [{
                    label: 'Quantidade de Peças',
                    data: [10, 5, 8], // Exemplos de quantidades
                    backgroundColor: ['rgba(75, 192, 192, 0.2)'],
                    borderColor: ['rgba(75, 192, 192, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Gráfico de linhas para montagens
        new Chart(ctxMontagens, {
            type: 'line',
            data: {
                labels: ['Janeiro', 'Fevereiro', 'Março'], // Exemplos de meses
                datasets: [{
                    label: 'Montagens por Mês',
                    data: [3, 2, 4], // Exemplos de montagens
                    fill: false,
                    borderColor: 'rgba(153, 102, 255, 1)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Chamar a função para criar gráficos quando a página carregar
    window.onload = function() {
        carregarPecas();
        criarGraficos();
    };
</script>

</body>
</html>
